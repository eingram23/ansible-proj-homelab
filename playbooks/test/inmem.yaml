---
- name: inmem Test
  hosts: all
  gather_facts: false

  tasks:

    - name: Create inmem inventory
      ansible.builtin.add_host:
        host: "{{ item }}"
        test: "test"
      with_items: "{{ ansible_play_hosts_all }}"
      delegate_to: localhost
      run_once: true

    - name: Display host var
      ansible.builtin.debug:
        var: "{{ hostvars[item]['test'] }}"
      with_items: "{{ ansible_play_hosts_all }}"
      delegate_to: localhost
      run_once: true