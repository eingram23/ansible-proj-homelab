- name: Login to vault and use the resulting token
  community.hashi_vault.vault_login:
    url: https://vault.local.lan
    auth_method: userpass
    username: "eingram"
    password: "{{ lookup('hashi_vault', 'secret=secret/ssh/eingram:ssh_password') }}"
    validate_certs: false
  register: login_data

- name: Generate a certificate with an existing token
  community.hashi_vault.vault_pki_generate_certificate:
    role_name: ycdisp-dot-net
    common_name: metrics-srv1.ycdisp.net
    ttl: 8760h
    url: https://vault.local.lan
    auth_method: token
    token: "{{ login_data.login.auth.client_token }}"
  register: cert_data