---
- name: Deploy monitoring pod and containers (prometheus, grafana, vmware_exporter, alertmanager)
  hosts: "{{ hostvar | default([]) }}"
  gather_facts: false
  become: true
  become_method: sudo
  become_user: poduser

  vars:
    pod_name: "monitoring"
    publish_ports:
      - "9090:9090"
      - "9093:9093"
      - "3000:3000"
      - "9272:9272"

  tasks:

    - name: Create monitoring pod
      ansible.builtin.include_role:
        name: eingram23.containers.create_pod

    - name: Create prometheus container
      ansible.builtin.include_role:
        name: eingram23.containers.prometheus
      tags: update_prometheus

    - name: Create grafana container
      ansible.builtin.include_role:
        name: eingram23.containers.grafana

    - name: Create vmware_exporter container
      ansible.builtin.include_role:
        name: eingram23.containers.vmware_exporter

    - name: Create alertmanager container
      ansible.builtin.include_role:
        name: eingram23.containers.alertmanager
      tags: update_alertmanager
