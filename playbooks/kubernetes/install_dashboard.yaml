- name: Install kubernetes dashboard (requires metallb)
  hosts: "{{ hostvar }}"
  gather_facts: false
  become: false

  tasks:

    - name: Check to see if metallb is installed
      kubernetes.core.k8s_info:
        api_version: metallb.io/v1beta1
        kind: L2Advertisement
        name: default-pool-l2adv
        namespace: metallb-system
        kubeconfig: /etc/rancher/k3s/k3s.yaml
      register: metallb_installed

    - name: Install dashboard
      ansible.builtin.include_role:
        name: eingram23.kubernetes.manifest
        tasks_from: apply
      vars:
        manifest: "dashboard-metallb"
      when: metallb_installed['resources']
      

    